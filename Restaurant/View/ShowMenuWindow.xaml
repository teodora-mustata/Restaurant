<Window x:Class="Restaurant.View.ShowMenuWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Restaurant.View"
        xmlns:model="clr-namespace:Restaurant.Model"
        xmlns:helpers="clr-namespace:Restaurant"
        mc:Ignorable="d"
        Title="ShowMenuWindow" Height="800" Width="800">
    <Window.Resources>
        <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <helpers:OrderItemToTextConverter x:Key="OrderItemToTextConverter"/>
        <!-- Template pentru PRODUCT -->
        <DataTemplate x:Key="ProductTemplate" DataType="{x:Type model:Product}">
            <Border BorderThickness="1" Padding="10" Margin="5" BorderBrush="LightGray">
                <StackPanel Orientation="Horizontal" Margin="5">
                    <Image Source="{Binding ImagePath}" Width="100" Height="100" Margin="5"/>
                    <StackPanel Margin="10,0,0,0">
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="16"/>
                        <TextBlock Text="{Binding Price, StringFormat='Price: {0:0.00} lei'}"/>
                        <TextBlock Text="{Binding Category.Name, StringFormat='Category: {0}'}"/>
                        <TextBlock Text="{Binding QuantityPerServing, StringFormat='Quantity per serving: {0}g'}"/>
                        <TextBlock Text="{Binding IsVegan, StringFormat='Vegan: {0}'}"/>
                        <TextBlock Text="{Binding IsVegetarian, StringFormat='Vegetarian: {0}'}"/>
                        <TextBlock Text="Ingredients:" FontWeight="Bold"/>
                        <ItemsControl ItemsSource="{Binding Ingredients}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Name}"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <TextBlock Text="Allergens:" FontWeight="Bold" Margin="5,2,0,0"/>
                        <ItemsControl ItemsSource="{Binding Allergens}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Name}"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <TextBlock Text="OUT OF STOCK"
                                   Foreground="Red"
                                   FontWeight="Bold"
                                   Visibility="{Binding IsOutOfStock, Converter={StaticResource BoolToVisibilityConverter}}" />

                    </StackPanel>
                </StackPanel>
            </Border>
        </DataTemplate>

        <!-- Template pentru BUNDLE -->
        <DataTemplate x:Key="BundleTemplate" DataType="{x:Type model:Bundle}">
            <Border BorderThickness="1" Padding="10" Margin="5" BorderBrush="LightGray">
                <StackPanel Orientation="Horizontal" Margin="5">
                    <Image Source="{Binding ImagePath}" Width="100" Height="100" Margin="5"/>
                    <StackPanel Margin="10,0,0,0">
                        <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="16"/>
                        <TextBlock Text="{Binding Price, StringFormat='Price: {0:0.00} lei'}"/>
                        <TextBlock Text="{Binding Category.Name, StringFormat='Category: {0}'}"/>
                        <TextBlock Text="Products:" FontWeight="Bold"/>
                        <ItemsControl ItemsSource="{Binding BundleProducts}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock>
                                    <Run Text="{Binding Product.Name}" />
                                    <Run Text=" - " />
                                    <Run Text="{Binding Quantity}" />
                                    <Run Text="g" />
                                    </TextBlock>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <TextBlock Text="OUT OF STOCK"
                                   Foreground="Red"
                                   FontWeight="Bold"
                                   Visibility="{Binding IsOutOfStock, Converter={StaticResource BoolToVisibilityConverter}}" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </DataTemplate>

        <helpers:MenuItemTemplateSelector x:Key="MenuSelector"
    ProductTemplate="{StaticResource ProductTemplate}"
    BundleTemplate="{StaticResource BundleTemplate}" />

    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <TabControl 
            ItemsSource="{Binding AllCategories}" 
            SelectedItem="{Binding SelectedCategory, Mode=TwoWay}" 
            Margin="10"
            Padding="0"
            Grid.Row="0">
            <TabControl.ItemTemplate>
                <DataTemplate>
                    <TextBlock Text="{Binding Name}" Padding="5,2"/>
                </DataTemplate>
            </TabControl.ItemTemplate>

            <TabControl.ContentTemplate>
                <DataTemplate>
                    <Border 
                    Padding="0" 
                    Margin="0" 
                    BorderThickness="0" 
                    Background="Transparent">

                        <ListBox 
                        ItemsSource="{Binding DataContext.FilteredItems, RelativeSource={RelativeSource AncestorType=Window}}" 
                        SelectedItem="{Binding DataContext.SelectedMenuItem, RelativeSource={RelativeSource AncestorType=Window}, Mode=TwoWay}"
                        Padding="0" 
                        Margin="0"
                        BorderThickness="0"
                        Background="Transparent"
                        ItemTemplateSelector="{StaticResource MenuSelector}">
                        </ListBox>
                    </Border>
                </DataTemplate>
            </TabControl.ContentTemplate>
        </TabControl>

        <StackPanel Orientation="Horizontal" Margin="10,0,10,10" Grid.Row="1" HorizontalAlignment="Center">
            <TextBlock Text="Search:" Width="50" Margin="10,0,0,0"/>
            <TextBox Width="200" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />
            <CheckBox Content="Exclude matches" Margin="10,0,0,0" IsChecked="{Binding ExcludeMatches, Mode=TwoWay}" />
        </StackPanel>


        <StackPanel Orientation="Horizontal" Margin="10,0,10,10" Grid.Row="2" Visibility="{Binding IsClientLoggedIn, Converter={StaticResource BoolToVisibilityConverter}}">
            <TextBlock Text="Quantity:" Width="60" Margin="10,0,0,0" />
            <TextBox Width="50" Text="{Binding SelectedQuantity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            <Button Content="Add to Cart" Width="100" Background="LightGreen" Margin="30,0,0,0"  Command="{Binding AddToCartCommand}"/>
            <Button Content="Remove from Cart" Command="{Binding RemoveFromCartCommand}"  Margin="30,0,0,0"  HorizontalAlignment="Center"/>
        </StackPanel>

        <StackPanel Orientation="Horizontal" Margin="10,0,10,10" Grid.Row="3" Visibility="{Binding IsClientLoggedIn, Converter={StaticResource BoolToVisibilityConverter}}">
            <TextBlock Text="Shopping cart:" Width="100" Margin="10,0,0,0"/>
            <ListBox ItemsSource="{Binding Cart}" Width="250" Height="150" SelectedItem="{Binding SelectedCartItem}">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding ., Converter={StaticResource OrderItemToTextConverter}}" />
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
            <StackPanel Orientation="Vertical" Margin="60,0,0,0">
                <TextBlock Text="Estimated price:" Margin="10,0,10,0" HorizontalAlignment="Center"/>
                <TextBlock Text="{Binding CartTotalPrice, StringFormat={}{0:0.00} lei}" HorizontalAlignment="Center" />
                <Button Content="PLACE ORDER" Background="LightGreen" Margin="20" FontSize="25" HorizontalAlignment="Center" Command="{Binding PlaceOrderCommand}"/>
            </StackPanel>
        </StackPanel>
    </Grid>
</Window>
